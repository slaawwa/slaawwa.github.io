<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>iframe</title>
</head>
<body>
    <h1>FROM IFRAME</h1>
    <button id="subscribeBtn">SUBSCRIBE</button>
    <button id="unsubscribeBtn">Unsubscribe</button>
    |
    <button id="emitBtn">Emit</button>


    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script>
        $(() => {

            let subscribeFn = function(event) {
                console.log('message:::', event)
                console.log('data:::', event.data)
                console.log('source:::', event.source)
                if (event.origin !== "http://example.org:8080") {
                    return;
                }
            };

            $('#subscribeBtn').click(() => {
                console.log('window', window);
                // window.contentWindow.postMessage(message, targetOrigin, [transfer]);
                // https://developer.mozilla.org/ru/docs/Web/API/Window/postMessage
                window.addEventListener("message", subscribeFn, false);
            });

            $('#unsubscribeBtn').click(() => {
                window.removeEventListener('message', subscribeFn);
            });
        });
        $(() => {
            $('#emitBtn').click(() => {
                console.log('window.parent:::', window.parent);
                let message = {
                    data: 321,
                }
                window.parent.postMessage(message, '*');
            });
        });
    </script>
</body>
</html>
