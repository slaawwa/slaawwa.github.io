<!DOCTYPE html><html ng-app="app"><head><meta charset="utf-8"><title>Login &bullet; BTC admin</title><meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><link rel="icon" type="image/png" href="/static/admin/favicon-16x16.png" sizes="16x16"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"><link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"><style>body {
    padding-top: 40px;
    padding-bottom: 40px;
    background-color: #eee;
}

.form-signin {
    max-width: 330px;
    padding: 15px;
    margin: 0 auto;
}
.form-signin .form-signin-heading,
.form-signin .checkbox {
    margin-bottom: 10px;
}
.form-signin .checkbox {
    font-weight: normal;
}
.form-signin .form-control {
    position: relative;
    height: auto;
    -webkit-box-sizing: border-box;
       -moz-box-sizing: border-box;
            box-sizing: border-box;
    padding: 10px;
    font-size: 16px;
}
.form-signin .form-control:focus {
    z-index: 2;
}
.form-signin input[type="email"] {
    margin-bottom: -1px;
    border-bottom-right-radius: 0;
    border-bottom-left-radius: 0;
}
.form-signin input[type="password"] {
    margin-bottom: 10px;
    border-top-left-radius: 0;
    border-top-right-radius: 0;
}</style><link href="/login.b6e067fff1.css" rel="stylesheet"></head><body ng-controller="MainCtrl as Main"><div id="content"><main><div class="container"><form class="form-signin"><h2 class="form-signin-heading">Please sign in</h2><label class="sr-only" for="inputEmail">Email address</label><input class="form-control" id="inputEmail" type="email" placeholder="Email address" required="" autofocus=""><label class="sr-only" for="inputPassword">Password</label><input class="form-control" id="inputPassword" type="password" placeholder="Password" required=""><div class="checkbox"><label><input type="checkbox" value="remember-me"> Remember me</label></div><button class="btn btn-lg btn-primary btn-block" type="submit">Sign in</button></form></div></main></div><script src="//ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script><script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/angular.js/1.6.7/angular.min.js"></script><script>'use strict';
((_site={}) => {

    let site = Object.assign(_site, {
        ngInit: () => {
            site.app = angular.module('app', [])
                .run([() => {

                    console.info('ng-init app');

                }]);

            return site;
        },
        setActiveMenu: () => {

            // Set current item menu
            let current = location.pathname;
            current.startsWith('/admin/history') && (current = '/admin/history');
            
            $('.sidebar a').each(function() {
                let href = $(this).attr('href');
                if (current === href) {
                    $(this).parent().addClass('active');
                }
            });
            
            return site;
        },
        init: () => {

            site
                .ngInit()
                .setActiveMenu();

            // site.ng.api();
            // site.ng.ctrl();

            return site;
        },
    });

    window.site = site.init();

})(window.site || {});</script><script>'use strict';
((_site={}) => {

    let site = Object.assign(_site, {
        api: () => {
            site.app.service('api', ['$http', function($http) {
                const urls = {
                    user: {
                        send:       userID => `/api/admin/send/${userID}`,
                        status:     '/api/status',
                        getProfile: '/api/profile',
                        getPosts:   '/api/profile/posts',
                        newPost:    '/api/post/new',
                    },
                    code: {
                        list: '/api/code',
                        del: '/api/code/del',
                        blockUnblock: '/api/code/block',
                    },
                },

                _send = function(url, data = {}, method = 'POST') {
                    data.token = site.token;
                    if (method.toUpperCase() === 'GET' && Object.keys(data).length) {
                        url += `?${$.param(data)}`;
                    }
                    return $http({
                        method,
                        url,
                        data,
                        credentials: 'same-origin',
                        headers: {
                            'x-requested-with': 'XMLHttpRequest',
                        },
                        /*headers: {
                            // 'X_CSRFTOKEN': data.csrfmiddlewaretoken,
                            // 'X_CSRFToken': data.csrfmiddlewaretoken,
                            'X-CSRFToken': data.csrfmiddlewaretoken
                        }*/
                    }).then(({data})=> data);
                },

                types = {byID: 1, byFB: 2, byVK: 3};

                return {
                    user: {
                        status: () => {
                            return _send(urls.user.status);
                        },
                        getPosts: (id, type) => {
                            return _send(urls.user.getPosts, {type: types[type], id: id});
                        },
                        newPost: (data) => {
                            return _send(urls.user.newPost, data);
                        },
                        getProfile: (id, type) => {
                            return _send(urls.user.getProfile, {type: types[type], id: id});
                        },
                        send: (userID, from, mess) => {
                            return _send(urls.user.send(userID), {from, mess});
                        },
                    },
                    code: {
                        list: () => {
                            return _send(urls.code.list, {}, 'GET');
                        },
                        blockUnblock: ({code, block}) => {
                            if (!block) block = '';
                            return _send(urls.code.blockUnblock, {code, block}, 'GET');
                        },
                        del: code => {
                            if (typeof code === 'object') code=code.code
                            return _send(urls.code.del, {code}, 'GET');
                        },
                    },
                };

            }]);
        },
        init: () => {

            // site.ng.init();
            site.api();
            // site.ng.ctrl();

            return site;
        },
    });

    window.site = site.init();

})(window.site || {});</script><script>'use strict';
(site => {
    site.app.controller('MainCtrl', ['$http', 'api', function($http, api) {
        let Main = this;
        site.$http = $http;
        site.api = api;
        site.main = Main;

        //- api.code.list()
        //-     .then(({data: codes}) => {
        //-         console.log('codes::', codes)
        //-         Main.codes = codes;
        //-     });

        Main.blockUnblock = c => {
            api.code.blockUnblock({
                code: c.code,
                block: !c.block,
            }).then(res => {
                c.block = res.block;
                console.log('res::', res);
            });
        }
        
        Main.delete = c => {
            if (confirm('Are you sure?')) {
                api.code.del(c.code)
                    .then(res => {
                        let index = Main.codes.indexOf(c);
                        Main.codes.splice(index, 1);
                        console.log('del::', res);
                    });
            }
        }

    }]);
})(window.site);</script><script type="text/javascript" src="/login.17c576071c4e.min.js"></script></body></html>